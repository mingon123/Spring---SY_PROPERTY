<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_mypage}">

<head>
  <meta charset="UTF-8">
  <title>ë§¤ë¬¼ ë“±ë¡ ì‹ ì²­</title>
  <link rel="stylesheet" th:href="@{/assets/css/hd.mypage.css}" type="text/css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- âœ… ì£¼ì†Œ ê²€ìƒ‰ìš© (daum.Postcode ê°ì²´ ì œê³µ) -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

</head>

<body>
<div layout:fragment="content" class="page-main">
  <div class="user-mypage-container">
    <div class="user-mypage-header">ë§¤ë¬¼ ë“±ë¡ ì‹ ì²­</div>

    <form id="propertyForm" th:action="@{/realtor/signProperty}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

      <!-- ë§¤ë¬¼ ì œëª© -->
      <div class="form-row">
        <label for="title">ë§¤ë¬¼ ì œëª©</label>
        <input type="text" id="title" name="title" required />
      </div>

      <!-- ì£¼ì†Œ ì…ë ¥ -->
      <div class="form-row">
        <label for="address1">ì£¼ì†Œ</label>
        <input type="text" id="zipcode" name="zipcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly style="width:100px;" />
        <input type="text" id="address1" name="address" placeholder="ì£¼ì†Œ ê²€ìƒ‰ í´ë¦­" readonly onclick="execKakaoPostcode()" required />
        <input type="text" id="address2" name="addressDetail" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥" required />
      </div>

      <!-- ìœ„ë„/ê²½ë„ ìˆ¨ê¹€ -->
      <input type="hidden" id="latitude" name="latitude" />
      <input type="hidden" id="longitude" name="longitude" />

      <div class="form-row">
        <label for="room_type">ë°© ì¢…ë¥˜</label>
        <input type="text" id="room_type" name="room_type" required />
      </div>

      <div class="form-row">
        <label for="price">ê°€ê²© ì •ë³´</label>
        <input type="text" id="price" name="price" required />
      </div>

      <div class="form-row">
        <label for="area_m2">ë©´ì (mÂ²)</label>
        <input type="number" id="area_m2" name="area_m2" step="0.1" required />
      </div>

      <div class="form-row">
        <label for="bed_count">ë°© ìˆ˜</label>
        <input type="number" id="bed_count" name="bed_count" required />
      </div>

      <div class="form-row">
        <label for="bathroom_count">í™”ì¥ì‹¤ ìˆ˜</label>
        <input type="number" id="bathroom_count" name="bathroom_count" required />
      </div>

      <div class="form-row">
        <label for="floor_info">ì¸µìˆ˜ ì •ë³´</label>
        <input type="text" id="floor_info" name="floor_info" required />
      </div>

      <div class="form-row">
        <label for="building_floors">ê±´ë¬¼ ì´ ì¸µìˆ˜</label>
        <input type="text" id="building_floors" name="building_floors" required />
      </div>

      <div class="form-row">
        <label for="parking">ì£¼ì°¨ ì—¬ë¶€</label>
        <input type="text" id="parking" name="parking" required />
      </div>

      <div class="form-row">
        <label for="maintenance_cost">ê´€ë¦¬ë¹„</label>
        <input type="text" id="maintenance_cost" name="maintenance_cost" />
      </div>

      <div class="form-row">
        <label for="move_in_date">ì…ì£¼ ê°€ëŠ¥ì¼</label>
        <input type="text" id="move_in_date" name="move_in_date" />
      </div>

      <div class="form-row">
        <label for="approval_date">ì‚¬ìš© ìŠ¹ì¸ì¼</label>
        <input type="text" id="approval_date" name="approval_date" />
      </div>

      <div class="form-row">
        <label for="complex_name">ë‹¨ì§€ëª… ë˜ëŠ” ê±´ë¬¼ëª…</label>
        <input type="text" id="complex_name" name="complex_name" />
      </div>

      <div class="form-row">
        <label for="household_num">ì´ ì„¸ëŒ€ìˆ˜</label>
        <input type="number" id="household_num" name="household_num" />
      </div>

      <div class="form-row">
        <label for="exclusive_area_m2">ì „ìš©ë©´ì (mÂ²)</label>
        <input type="number" id="exclusive_area_m2" name="exclusive_area_m2" step="0.1" />
      </div>

      <div class="form-row">
        <label for="supply_area_m2">ê³µê¸‰ë©´ì (mÂ²)</label>
        <input type="number" id="supply_area_m2" name="supply_area_m2" step="0.1" />
      </div>

      <div class="form-row">
        <label for="hashtags">í•´ì‹œíƒœê·¸</label>
        <input type="text" id="hashtags" name="hashtags" placeholder="#ì‹ ì¶• #ì—­ì„¸ê¶Œ ë“±" />
      </div>

      <div class="form-row">
        <label for="options">ì˜µì…˜</label>
        <textarea id="options" name="options" placeholder="ì˜ˆ: ëƒ‰ì¥ê³ , ì„¸íƒê¸°, ì—ì–´ì»¨ ë“±"></textarea>
      </div>

      <div class="form-row">
        <label for="category">ë§¤ë¬¼ ìœ í˜•</label>
        <select id="category" name="category" required>
          <option value="">ï¼ï¼ ì„ íƒí•˜ì„¸ìš” ï¼ï¼</option>
          <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
          <option value="ì˜¤í”¼ìŠ¤í…”">ì˜¤í”¼ìŠ¤í…”</option>
          <option value="ë¹Œë¼">ë¹Œë¼</option>
          <option value="ì›ë£¸/íˆ¬ë£¸">ì›ë£¸/íˆ¬ë£¸</option>
        </select>
      </div>

	  
	  <div class="form-button-box">
	         <div class="button-group">
	           <button type="button" class="action-btn submit-btn" onclick="submitForm()">ì‹ ì²­í•˜ê¸°</button>
	           <button type="button" class="action-btn cancel-btn" onclick="history.back()">ì·¨ì†Œ</button>
	         </div>
	       </div>
	     </form>
    <!-- JS  -->

	<script>
		function execKakaoPostcode() {
		   new daum.Postcode({
		     oncomplete: function(data) {
		       const roadAddress = data.roadAddress;
		       const jibunAddress = data.jibunAddress;
		       const fullAddr = roadAddress || jibunAddress;

		       $('#zipcode').val(data.zonecode);
		       $('#address1').val(fullAddr);

		       fetch(`/api/geocode?query=${encodeURIComponent(fullAddr)}`)
		         .then(res => res.json())
		         .then(data => {
		           if (data.documents && data.documents.length > 0) {
		             const lat = data.documents[0].y;
		             const lng = data.documents[0].x;
		             $('#latitude').val(lat);
		             $('#longitude').val(lng);
		             console.log("ğŸ“ ìœ„ë„:", lat, "ê²½ë„:", lng);
		           } else {
		             alert("âŒ ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		           }
		         })
		         .catch(err => {
		           console.error("âŒ ì˜¤ë¥˜:", err);
		           alert("âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
		         });
		     }
		   }).open();
		 }
		function getCoordsFromServer(address) {
		  $.get("/api/geocode", { query: address })
		    .done(function(response) {
		      let result;
		      try {
		        result = typeof response === "string" ? JSON.parse(response) : response;
		      } catch (e) {
		        console.error("âŒ JSON íŒŒì‹± ì‹¤íŒ¨", e);
		        return;
		      }

		      if (result && result.documents && result.documents.length > 0) {
		        const doc = result.documents[0];
		        document.getElementById("latitude").value = doc.y;
		        document.getElementById("longitude").value = doc.x;
		        console.log("ğŸ“ ìœ„ë„:", doc.y, "ê²½ë„:", doc.x);
		      } else {
		        alert("âŒ í•´ë‹¹ ì£¼ì†Œì— ëŒ€í•œ ì¢Œí‘œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
		      }
		    })
		    .fail(function(err) {
		      alert("âŒ ì„œë²„ì—ì„œ ì¢Œí‘œ ìš”ì²­ ì‹¤íŒ¨");
		      console.error(err);
		    });
		}
		function submitForm() {
		  const mainAddr = document.getElementById("address1").value;
		  const detailAddr = document.getElementById("address2").value;
		  const fullAddress = mainAddr + ' ' + detailAddr;

		  // í•©ì³ì§„ ì£¼ì†Œë¥¼ address1 inputì— ë‹¤ì‹œ ë„£ìŒ (name="address" ì´ë¯€ë¡œ ì„œë²„ì—ì„œ ì²˜ë¦¬ë¨)
		  document.getElementById("address1").value = fullAddress;

		  // ìœ„ê²½ë„ ìœ íš¨ì„± ê²€ì‚¬
		  const lat = document.getElementById("latitude").value;
		  const lng = document.getElementById("longitude").value;
		  if (!lat || !lng) {
		    alert("ğŸ“ ì£¼ì†Œ ì„ íƒ í›„ ì¢Œí‘œê°€ ì…ë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.");
		    return;
		  }

		  document.getElementById("propertyForm").submit();
		}

	</script>

	  </div>
	</div>
	</body>
	</html>