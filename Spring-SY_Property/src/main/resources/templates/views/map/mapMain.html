<!DOCTYPE html>
<html>
<head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>BangBangGo</title>
	<link rel="stylesheet" type="text/css" th:href="@{/assets/css/common.css}" >
	<link rel="stylesheet" th:href="@{/assets/css/hd.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/assets/css/jw_map.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/assets/css/hd.chat.css}" >
	<link rel="stylesheet" type="text/css" th:href="@{/assets/css/hd.chatPopup.css}" >
	<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=zeq1aw9idd&callback=initMap"></script>
	<script type="text/javascript" th:src="@{/assets/js/jquery-3.7.1.min.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/chat.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/regionCoordinates.js}"></script>
	<script type="text/javascript">
	var map; //ì „ì—­ ì„ ì–¸

	function initMap() {
    	// naver ê°ì²´ê°€ í™•ì‹¤íˆ ë¡œë“œëëŠ”ì§€ ì²´í¬
    	if (typeof naver !== 'undefined' && naver.maps) {
    		var mapOptions = {
    		    	zoomControl: false, //ì¤Œ ì»¨íŠ¸ë¡¤ í‘œì‹œ ì—¬ë¶€
    		    	minZoom:9, //ì§€ë„ì˜ ìµœì†Œ ì¤Œ ë ˆë²¨
    		    	maxZoom:18, //ì§€ë„ì˜ ìµœëŒ€ ì¤Œ ë ˆë²¨
    		    	zoom:13, //ì§€ë„ì˜ ì´ˆê¸° ì¤Œ ë ˆë²¨
    		    	disableKineticPan:true, //ê´€ì„± ë“œë˜ê¹… ë„ê¸°
    		    	tileTransition: true //íƒ€ì¼ fade-in íš¨ê³¼ ì¼œê¸°
    			};
    		map = new naver.maps.Map('map', mapOptions);
    		naver.maps.Event.once(map, 'init', function() {
    			setupDistanceMeasuring(map);
    			drawMarkersOnMap();
    			setupUserLocation();
    		});
    	} else {
      		console.error('naver ê°ì²´ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    	}
  	}
	</script>
	<script type="text/javascript" th:src="@{/assets/js/MarkerClustering.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/customMap.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/measureDistance.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/propertyBox.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/clusterPropertyMarker.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/goToMyLocation.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/propertyDetail.js}"></script>
</head>
<body>
<div id="main">
	<!-- í—¤ë” -->
	<div th:insert="fragments/header::header"></div>

	<div class="map-container">	  
		<!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
		<aside th:insert="fragments/map_nav :: sidebar" style="border-right: 1px solid #ddd;"></aside>
		<!-- ì˜¤ë¥¸ìª½ ì „ì²´ ì˜ì—­ -->
		<div class="map-right-area">
	    	<!-- ê²€ìƒ‰ í•„í„° ë°” (ì§€ë„/ë©”ë‰´ë°•ìŠ¤ ìœ„) -->
	    	<div th:insert="fragments/map_search_filter :: topbar" class="search-filter-box"></div>
	    	<!-- ë©”ë‰´ë°•ìŠ¤ + ì§€ë„ ì˜ì—­ -->
	    	<div class="map-content">
	      		<div class="menu-box">
					<!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ íˆë“ ê°’ ë Œë”ë§ -->
					<div th:if="${loginUser != null}">
					  <input type="hidden" id="user_num_hidden" th:value="${loginUser.user_num}" />
					  <input type="hidden" id="user_role_hidden" th:value="${loginUser.authority}" />
					</div>

	        		<div class="property-header-tag">ë§¤ë¬¼</div>
					
	        		<!-- ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ ì˜ì—­ -->
					<div class="property-list"></div>
					
  					<!-- ê±°ë¦¬ì¬ê¸° ê¸°ëŠ¥ í™œì„±í™” ì‹œ -->
	        		<div class="distance-guide" id="distance-guide" style="display:none;">
      					<img src="/assets/images/distanceLine.png" alt="ê±°ë¦¬ì¬ê¸°" style="max-width:100%; height:auto;">
      					<p>ê±°ë¦¬ë¥¼ ê³„ì‚°í•  ì§€ì ì„ ì§€ë„ì—ì„œ í´ë¦­í•´ì£¼ì„¸ìš”.</p>
      					<p>ê±°ë¦¬ì¬ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒˆë¡œ ì„ ì„ ê·¸ë¦´ ìˆ˜ ìˆì§€ë§Œ,</p>
      					<p>ì´ì „ì— ê·¸ë¦° ì„ ì´ ì¡´ì¬í•  ê²½ìš° ì´ì „ì— ê·¸ë¦° ì„ ì€ ì‚­ì œë©ë‹ˆë‹¤.</p>
      					<button id="cancelMeasureBtn">ì·¨ì†Œ</button>
    				</div>
    				<!-- ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ” ê²½ìš° -->
    				<div id="empty-message" style="display: none;">
  						<img src="/assets/images/no_property.png" alt="ë§¤ë¬¼ì—†ìŒ" style="width: 80px; opacity: 0.6;">
  						<p>ì¡°ê±´ì— ë§ëŠ” ë°©ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ì¹˜ ë° ë§ì¶¤í•„í„°ë¥¼ ì¡°ì •í•´ë³´ì„¸ìš”.</p>
					</div>
	      		</div>
	      		
	      		<div class="map-area">
	      			<!-- ë§¤ë¬¼ ìƒì„¸ì •ë³´ íŒ¨ë„ (ì§€ë„ì™€ ë³„ë„, ê³ ì •ëœ ì˜¤ë¥¸ìª½ ìœ„ì¹˜) -->
					<div id="property-detail-panel" class="property-detail-panel" style="display: none;">
  						<!-- <button id="close-detail-btn" class="detail-close-btn">Ã—</button> -->
					</div>
					
	      			<!-- ì§€ë„ ê´€ë ¨  -->
	      			<div id="map" style="flex-grow: 1;height:100%;width:100%;position:relative;"></div>
	      			
	      			<!-- ì¤Œê´€ë ¨ ì»¤ìŠ¤í…€ ë²„íŠ¼ -->
	      			<div id="custom-zoom-controls">
						<button id="zoom-in">+</button>
						<button id="zoom-out">âˆ’</button>
		   			</div>
		   			<!-- ì§€ë„ ìœ í˜• ì„ íƒê´€ë ¨ ì»¤ìŠ¤í…€ ë²„íŠ¼ -->
		   			<div id="custom-mapType-select">
			 			<button id="map-type-select">ì§€ë„</button>
					</div>
					<div id="custom-mapType-controls" style="display: none;">
						<button id="map-type-normal">ì¼ë°˜</button>
						<button id="map-type-satellite">ìœ„ì„±</button>
						<button id="map-type-hybrid">í˜¼í•©</button>
						<button id="map-type-terrain">ì§€í˜•ë„</button>
					</div>
					<!-- ê±°ë¦¬ì¬ê¸° ê´€ë ¨ ë²„íŠ¼ -->
					<div id="custom-clear-line" style="display: none;">
  						<button id="clearLinesBtn">ì„  ì‚­ì œ</button>
					</div>
					<div id="custom-draw-line">
						<button id="measureBtn">ê±°ë¦¬ì¬ê¸°</button>
					</div>
					<!-- ì‚¬ìš©ì í˜„ì¬ìœ„ì¹˜ ì´ë™ ë²„íŠ¼ -->
					<div id="custom-location-button">
						<button id="go-to-myLocation">
							<img src="/assets/images/myLocation.png" alt="ë‚´ ìœ„ì¹˜"/>
						</button>
					</div>
				</div>
	    	</div>
	  	</div>
	</div>
</div>
<!-- footer ì‹œì‘ -->
<div th:insert="fragments/footer::footer"></div>
<!-- footer ë -->
<script>

/*
//-------------------------ì‚¬ìš©ì ìœ„ì¹˜ì— ë”°ë¥¸ ë§ˆì»¤ í‘œì‹œ------------
if(navigator.geolocation){
	navigator.geolocation.getCurrentPosition(function(position){
		const userLat = position.coords.latitude;
		const userLng = position.coords.longitude;
		
		const userLocation = new naver.maps.LatLng(userLat,userLng);
		map.setCenter(userLocation);
		
		new naver.maps.Marker({
			position: userLocation,
			map: map,
			title: "í˜„ì¬ ìœ„ì¹˜" 
		});
	},function(err){
		console.error("ìœ„ì¹˜ ì˜¤ë¥˜", err);
	});
} else{
	alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ì´ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
}
*/

/*
// ì‚¬ì´ë“œ ë©”ë‰´ ëˆŒë €ì„ ë•Œ ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ ë™ì ìœ¼ë¡œ ë°”ê¿”ì£¼ê¸° 
document.addEventListener("DOMContentLoaded", function(){
	const menuBox = document.querySelector(".menu-box");
	const menuLinks = document.querySelectorAll(".menu-link");
	
	// ---------------------ì˜ˆì‹œ ë‚´ìš©---------------------
	// ë‚˜ì¤‘ì— ë°ì´í„°ë² ì´ìŠ¤, ìë°”ë‘ ì—°ê²°
	const menuContents = {
	   room: ['ë°© ë³´ê¸°', 'ì›”ì„¸ ì‹œì„¸', 'ì˜µì…˜ë³„ ë³´ê¸°','ì±„íŒ…ë°©'],
	   apartment: ['ë‹¨ì§€ ì •ë³´', 'ì‹¤ê±°ë˜ê°€', 'ë§¤ë§¤ ì‹œì„¸'],
	   house: ['ì£¼íƒ í˜„í™©', 'ì „ì„¸ ì‹œì„¸'],
	   officetel: ['ì˜¤í”¼ìŠ¤í…” ì‹œì„¸', 'ì˜µì…˜ë³„ ë³´ê¸°'],
	   sale: ['ë¶„ì–‘ ì¼ì •', 'ì²­ì•½ ì •ë³´']
	};
	//-------------------------------------------------
	
	menuLinks.forEach(link=>{
		link.addEventListener("click",function(e){
			e.preventDefault();
			const type = this.dataset.type;
			const items = menuContents[type] || ["ë©”ë‰´ ì„ íƒ í•˜ì„¸ìš”"];
			
			menuBox.innerHTML = '';
			
			items.forEach(item => {
				const div = document.createElement('div');
				div.className = 'menu-summary';
				div.textContent = item;
				menuBox.appendChild(div);
			})
		})
	})
})
*/



</script>

<div id="chat-modal" class="chat-popup-overlay">
  <div class="chat-popup-box">
    <div class="chat-popup-header">
      <span>ğŸ’¬ ì±„íŒ…ë°©</span>
      <button class="chat-popup-close">&times;</button>
    </div>
    <iframe id="chat-iframe" src="" width="100%" height="100%" frameborder="0"></iframe>
  </div>
</div>


</body>
</html>